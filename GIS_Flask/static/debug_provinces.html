<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœä»½åç§°è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0e27;
            color: #8a92a6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00d4ff;
            text-align: center;
        }
        .section {
            background: #1a1f3a;
            border: 1px solid #2d3548;
            padding: 20px;
            margin: 20px 0;
        }
        .section h2 {
            color: #00d4ff;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #2d3548;
        }
        th {
            background: #0f1429;
            color: #00d4ff;
        }
        .match { color: #00ff88; }
        .mismatch { color: #ff6b6b; }
        button {
            background: #00d4ff;
            color: #0a0e27;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px;
        }
        button:hover {
            background: #00b8e6;
        }
        pre {
            background: #0f1429;
            padding: 15px;
            border: 1px solid #2d3548;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” çœä»½åç§°è°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <h2>1. åœ°å›¾æ•°æ®ä¸­çš„çœä»½åç§°</h2>
        <button onclick="loadMapData()">åŠ è½½åœ°å›¾æ•°æ®</button>
        <div id="mapProvinces"></div>
    </div>
    
    <div class="section">
        <h2>2. åç«¯APIè¿”å›çš„çœä»½åç§°</h2>
        <button onclick="loadApiData()">åŠ è½½APIæ•°æ®</button>
        <div id="apiProvinces"></div>
    </div>
    
    <div class="section">
        <h2>3. åç§°åŒ¹é…å¯¹ç…§è¡¨</h2>
        <button onclick="compareNames()">ç”Ÿæˆå¯¹ç…§è¡¨</button>
        <div id="comparison"></div>
    </div>
    
    <div class="section">
        <h2>4. æ¨èçš„æ˜ å°„ä»£ç </h2>
        <button onclick="generateCode()">ç”Ÿæˆä»£ç </button>
        <pre id="generatedCode"></pre>
    </div>
    
    <script>
        let mapProvinces = [];
        let apiProvinces = {};
        
        async function loadMapData() {
            try {
                const response = await fetch('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json');
                const geoJson = await response.json();
                
                mapProvinces = geoJson.features.map(f => f.properties.name).sort();
                
                let html = '<table><tr><th>åºå·</th><th>çœä»½åç§°</th></tr>';
                mapProvinces.forEach((name, index) => {
                    html += `<tr><td>${index + 1}</td><td>${name}</td></tr>`;
                });
                html += '</table>';
                
                document.getElementById('mapProvinces').innerHTML = html;
                console.log('åœ°å›¾çœä»½:', mapProvinces);
            } catch (error) {
                document.getElementById('mapProvinces').innerHTML = 
                    `<p class="mismatch">âŒ åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        async function loadApiData() {
            try {
                const response = await fetch('http://127.0.0.1:6667/api/data/population');
                const result = await response.json();
                
                if (result.code === 200) {
                    apiProvinces = result.data;
                    const provinceNames = Object.keys(apiProvinces).sort();
                    
                    let html = '<table><tr><th>åºå·</th><th>çœä»½ç®€ç§°</th><th>äººå£æ•°</th></tr>';
                    provinceNames.forEach((name, index) => {
                        html += `<tr><td>${index + 1}</td><td>${name}</td><td>${apiProvinces[name]}</td></tr>`;
                    });
                    html += '</table>';
                    
                    document.getElementById('apiProvinces').innerHTML = html;
                    console.log('APIçœä»½:', provinceNames);
                }
            } catch (error) {
                document.getElementById('apiProvinces').innerHTML = 
                    `<p class="mismatch">âŒ åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function compareNames() {
            if (mapProvinces.length === 0 || Object.keys(apiProvinces).length === 0) {
                alert('è¯·å…ˆåŠ è½½åœ°å›¾æ•°æ®å’ŒAPIæ•°æ®ï¼');
                return;
            }
            
            const apiNames = Object.keys(apiProvinces).sort();
            
            let html = '<table><tr><th>åç«¯ç®€ç§°</th><th>åœ°å›¾å…¨ç§°</th><th>åŒ¹é…çŠ¶æ€</th></tr>';
            
            apiNames.forEach(shortName => {
                // å°è¯•æ™ºèƒ½åŒ¹é…
                const matched = mapProvinces.find(fullName => {
                    // ç›´æ¥åŒ¹é…
                    if (fullName === shortName) return true;
                    
                    // ç§»é™¤åç¼€åŒ¹é…
                    let simplified = fullName;
                    const suffixes = ['çœ', 'å¸‚', 'è‡ªæ²»åŒº', 'ç‰¹åˆ«è¡Œæ”¿åŒº', 
                                     'ç»´å¾å°”è‡ªæ²»åŒº', 'å£®æ—è‡ªæ²»åŒº', 'å›æ—è‡ªæ²»åŒº'];
                    for (const suffix of suffixes) {
                        simplified = simplified.replace(suffix, '');
                    }
                    
                    // ç‰¹æ®Šå¤„ç†
                    if (simplified === 'å¹¿è¥¿å£®æ—') simplified = 'å¹¿è¥¿';
                    if (simplified === 'å®å¤å›æ—') simplified = 'å®å¤';
                    if (simplified === 'æ–°ç–†ç»´å¾å°”') simplified = 'æ–°ç–†';
                    
                    return simplified === shortName;
                });
                
                const status = matched ? 
                    `<span class="match">âœ… ${matched}</span>` : 
                    `<span class="mismatch">âŒ æœªæ‰¾åˆ°åŒ¹é…</span>`;
                
                html += `<tr><td><strong>${shortName}</strong></td><td>${matched || '?'}</td><td>${status}</td></tr>`;
            });
            
            html += '</table>';
            document.getElementById('comparison').innerHTML = html;
        }
        
        function generateCode() {
            if (mapProvinces.length === 0 || Object.keys(apiProvinces).length === 0) {
                alert('è¯·å…ˆåŠ è½½åœ°å›¾æ•°æ®å’ŒAPIæ•°æ®ï¼');
                return;
            }
            
            const apiNames = Object.keys(apiProvinces).sort();
            let code = '// çœä»½åç§°æ˜ å°„è¡¨ï¼ˆåç«¯ç®€ç§° -> EChartsåœ°å›¾å…¨ç§°ï¼‰\nconst provinceNameMap = {\n';
            
            apiNames.forEach(shortName => {
                const matched = mapProvinces.find(fullName => {
                    let simplified = fullName;
                    const suffixes = ['çœ', 'å¸‚', 'è‡ªæ²»åŒº', 'ç‰¹åˆ«è¡Œæ”¿åŒº', 
                                     'ç»´å¾å°”è‡ªæ²»åŒº', 'å£®æ—è‡ªæ²»åŒº', 'å›æ—è‡ªæ²»åŒº'];
                    for (const suffix of suffixes) {
                        simplified = simplified.replace(suffix, '');
                    }
                    
                    if (simplified === 'å¹¿è¥¿å£®æ—') simplified = 'å¹¿è¥¿';
                    if (simplified === 'å®å¤å›æ—') simplified = 'å®å¤';
                    if (simplified === 'æ–°ç–†ç»´å¾å°”') simplified = 'æ–°ç–†';
                    
                    return simplified === shortName;
                });
                
                if (matched) {
                    code += `    '${shortName}': '${matched}',\n`;
                }
            });
            
            code += '};\n';
            document.getElementById('generatedCode').textContent = code;
        }
    </script>
</body>
</html>

