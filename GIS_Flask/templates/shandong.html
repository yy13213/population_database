<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±±ä¸œçœäººå£æ•°æ®å¯è§†åŒ–ç³»ç»Ÿ</title>
    
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: #0a0e27;
            min-height: 100vh;
        }
        
        .header {
            background: #1a1f3a;
            padding: 24px 40px;
            border-bottom: 1px solid #2d3548;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: #00d4ff;
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header .subtitle {
            color: #8a92a6;
            font-size: 13px;
        }
        
        .header-links {
            display: flex;
            gap: 10px;
        }
        
        .header-link {
            padding: 10px 20px;
            background: #1a1f3a;
            border: 1px solid #2d3548;
            color: #00d4ff;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .header-link:hover {
            background: #2d3548;
            border-color: #00d4ff;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: #1a1f3a;
            padding: 16px 40px;
            border-bottom: 1px solid #2d3548;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #8a92a6;
            font-size: 13px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            50% { opacity: 1; box-shadow: 0 0 0 6px rgba(0, 255, 136, 0); }
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding: 24px 40px;
        }
        
        .stat-card {
            background: #1a1f3a;
            padding: 20px;
            border: 1px solid #2d3548;
        }
        
        .stat-card .icon {
            font-size: 24px;
            margin-bottom: 12px;
        }
        
        .stat-card .value {
            font-size: 28px;
            font-weight: 600;
            color: #00d4ff;
            margin: 8px 0;
        }
        
        .stat-card .label {
            color: #8a92a6;
            font-size: 12px;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0;
            padding: 0 40px;
            background: #1a1f3a;
            border-bottom: 1px solid #2d3548;
        }
        
        .nav-tab {
            padding: 14px 28px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: #8a92a6;
            border-bottom: 2px solid transparent;
        }
        
        .nav-tab:hover {
            color: #00d4ff;
        }
        
        .nav-tab.active {
            color: #00d4ff;
            border-bottom-color: #00d4ff;
        }
        
        .content {
            padding: 24px 40px;
        }
        
        .chart-container {
            background: #1a1f3a;
            border: 1px solid #2d3548;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .chart {
            width: 100%;
            height: 500px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #8a92a6;
        }
        
        .loading.show {
            display: block;
        }
        
        .btn {
            padding: 8px 18px;
            background: #00d4ff;
            color: #0a0e27;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #00b8e6;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1>ğŸ“ å±±ä¸œçœäººå£æ•°æ®å¯è§†åŒ–ç³»ç»Ÿ</h1>
                <div class="subtitle">åŸºäºæ•°æ®åº“è§†å›¾çš„å±±ä¸œçœä¸“å±æ•°æ®å¹³å°</div>
            </div>
            <div class="header-links">
                <a href="/" class="header-link">â† è¿”å›å…¨å›½</a>
                <a href="/query" class="header-link">ğŸ” æ™ºèƒ½æŸ¥è¯¢</a>
            </div>
        </div>
    </div>
    
    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
        <div class="status-item">
            <div class="status-dot"></div>
            <span>ç³»ç»Ÿè¿è¡Œä¸­</span>
        </div>
        <div class="status-item">
            <span id="lastUpdate">æœ€åæ›´æ–°: åŠ è½½ä¸­...</span>
        </div>
        <div class="status-item">
            <span id="nextUpdate">ä¸‹æ¬¡æ›´æ–°: åŠ è½½ä¸­...</span>
        </div>
        <div class="status-item">
            <button onclick="forceUpdate()" class="btn">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>
    </div>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="icon">ğŸ‘¥</div>
            <div class="value" id="totalPopulation">-</div>
            <div class="label">æ€»äººå£æ•°</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸ™ï¸</div>
            <div class="value" id="totalCities">-</div>
            <div class="label">åœ°çº§å¸‚æ•°é‡</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸ’‘</div>
            <div class="value" id="totalMarriages">-</div>
            <div class="label">å©šå§»è®°å½•</div>
        </div>
        <div class="stat-card">
            <div class="icon">âš°ï¸</div>
            <div class="value" id="totalDeaths">-</div>
            <div class="label">æ­»äº¡è®°å½•</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸš€</div>
            <div class="value" id="netMigration">-</div>
            <div class="label">å‡€è¿å…¥äººå£</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸ’°</div>
            <div class="value" id="avgIncome">-</div>
            <div class="label">å¹³å‡æœˆæ”¶å…¥</div>
        </div>
    </div>
    
    <!-- å¯¼èˆªæ ‡ç­¾ -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('city')">åŸå¸‚åˆ†å¸ƒ</button>
        <button class="nav-tab" onclick="switchTab('gender')">æ€§åˆ«æ¯”ä¾‹</button>
        <button class="nav-tab" onclick="switchTab('age')">å¹´é¾„åˆ†å¸ƒ</button>
        <button class="nav-tab" onclick="switchTab('education')">å—æ•™è‚²ç¨‹åº¦</button>
        <button class="nav-tab" onclick="switchTab('migration')">äººå£è¿ç§»</button>
        <button class="nav-tab" onclick="switchTab('ethnicity')">æ°‘æ—åˆ†å¸ƒ</button>
    </div>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <div id="loading" class="loading">
            <div>â³ æ­£åœ¨åŠ è½½æ•°æ®...</div>
        </div>
        
        <div class="chart-container">
            <div id="mainChart" class="chart"></div>
        </div>
    </div>
    
    <script>
        let currentTab = 'city';
        let allData = null;
        let mainChart = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            loadData();
            updateCacheInfo();
            setInterval(updateCacheInfo, 60000);
        });
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            mainChart = echarts.init(document.getElementById('mainChart'));
            window.addEventListener('resize', function() {
                mainChart.resize();
            });
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            console.log('\n' + '='.repeat(60));
            console.log('ğŸ“¥ å¼€å§‹åŠ è½½å±±ä¸œçœæ•°æ®');
            console.log('='.repeat(60));
            
            showLoading(true);
            
            try {
                console.log('ğŸŒ è¯·æ±‚URL: /api/shandong/data/all');
                const response = await fetch('/api/shandong/data/all');
                
                console.log('ğŸ“¡ HTTPçŠ¶æ€ç :', response.status);
                console.log('ğŸ“¡ HTTPçŠ¶æ€æ–‡æœ¬:', response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('ğŸ“¦ APIå“åº”:', result);
                
                if (result.code === 200) {
                    allData = result.data;
                    console.log('âœ… æ•°æ®åŠ è½½æˆåŠŸ');
                    console.log('ğŸ“Š æ•°æ®ç»“æ„:', {
                        'total_population': allData.total_population,
                        'city_population': allData.city_population ? Object.keys(allData.city_population).length + 'ä¸ªåŸå¸‚' : 'undefined',
                        'marriage': allData.marriage ? 'å­˜åœ¨' : 'undefined',
                        'death': allData.death ? 'å­˜åœ¨' : 'undefined',
                        'migration': allData.migration ? 'å­˜åœ¨' : 'undefined',
                        'income': allData.income ? 'å­˜åœ¨' : 'undefined'
                    });
                    
                    updateStats();
                    renderChart();
                } else {
                    console.error('âŒ APIè¿”å›é”™è¯¯:', result);
                    alert('åŠ è½½æ•°æ®å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½æ•°æ®å¼‚å¸¸:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                alert('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message);
            } finally {
                showLoading(false);
                console.log('='.repeat(60) + '\n');
            }
        }
        
        // æ›´æ–°ç¼“å­˜ä¿¡æ¯
        async function updateCacheInfo() {
            try {
                const response = await fetch('/api/shandong/cache/info');
                const result = await response.json();
                
                if (result.code === 200) {
                    const info = result.data;
                    document.getElementById('lastUpdate').textContent = 
                        'æœ€åæ›´æ–°: ' + info.last_update;
                    document.getElementById('nextUpdate').textContent = 
                        'ä¸‹æ¬¡æ›´æ–°: ' + info.next_update;
                }
            } catch (error) {
                console.error('è·å–ç¼“å­˜ä¿¡æ¯å¤±è´¥:', error);
            }
        }
        
        // å¼ºåˆ¶æ›´æ–°
        async function forceUpdate() {
            try {
                const response = await fetch('/api/shandong/cache/update', {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.code === 200) {
                    alert('âœ… ç¼“å­˜æ›´æ–°å·²è§¦å‘ï¼');
                    setTimeout(() => {
                        loadData();
                        updateCacheInfo();
                    }, 2000);
                } else {
                    alert('âŒ æ›´æ–°å¤±è´¥: ' + result.message);
                }
            } catch (error) {
                alert('âŒ æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStats() {
            console.log('\n' + '='.repeat(60));
            console.log('ğŸ“Š æ›´æ–°å±±ä¸œçœç»Ÿè®¡å¡ç‰‡');
            console.log('='.repeat(60));
            console.log('ğŸ“¦ æ¥æ”¶åˆ°çš„æ•°æ®:', allData);
            
            if (!allData) {
                console.error('âŒ allData ä¸ºç©ºï¼');
                return;
            }
            
            // å®‰å…¨åœ°è·å–æ•°æ®ï¼Œæä¾›é»˜è®¤å€¼
            const totalPop = allData.total_population || 0;
            const cityPop = allData.city_population || {};
            const marriageTotal = (allData.marriage && allData.marriage.total) || 0;
            const deathTotal = (allData.death && allData.death.total) || 0;
            const migrationNet = (allData.migration && allData.migration.net) || 0;
            const incomeAvg = (allData.income && allData.income.avg) || 0;
            
            console.log('ğŸ“ˆ æ•°æ®å€¼:');
            console.log('   - total_population:', totalPop);
            console.log('   - city_population:', cityPop);
            console.log('   - marriage.total:', marriageTotal);
            console.log('   - death.total:', deathTotal);
            console.log('   - migration.net:', migrationNet);
            console.log('   - income.avg:', incomeAvg);
            
            try {
                document.getElementById('totalPopulation').textContent = 
                    totalPop.toLocaleString();
                console.log('âœ… æ€»äººå£æ•°æ›´æ–°æˆåŠŸ');
            } catch (e) {
                console.error('âŒ æ›´æ–°æ€»äººå£æ•°å¤±è´¥:', e);
                document.getElementById('totalPopulation').textContent = '0';
            }
            
            try {
                document.getElementById('totalCities').textContent = 
                    Object.keys(cityPop).length;
                console.log('âœ… åŸå¸‚æ•°é‡æ›´æ–°æˆåŠŸ');
            } catch (e) {
                console.error('âŒ æ›´æ–°åŸå¸‚æ•°é‡å¤±è´¥:', e);
                document.getElementById('totalCities').textContent = '0';
            }
            
            try {
                document.getElementById('totalMarriages').textContent = 
                    marriageTotal.toLocaleString();
                console.log('âœ… å©šå§»è®°å½•æ›´æ–°æˆåŠŸ');
            } catch (e) {
                console.error('âŒ æ›´æ–°å©šå§»è®°å½•å¤±è´¥:', e);
                document.getElementById('totalMarriages').textContent = '0';
            }
            
            try {
                document.getElementById('totalDeaths').textContent = 
                    deathTotal.toLocaleString();
                console.log('âœ… æ­»äº¡è®°å½•æ›´æ–°æˆåŠŸ');
            } catch (e) {
                console.error('âŒ æ›´æ–°æ­»äº¡è®°å½•å¤±è´¥:', e);
                document.getElementById('totalDeaths').textContent = '0';
            }
            
            try {
                document.getElementById('netMigration').textContent = 
                    (migrationNet >= 0 ? '+' : '') + migrationNet.toLocaleString();
                console.log('âœ… å‡€è¿å…¥äººå£æ›´æ–°æˆåŠŸ');
            } catch (e) {
                console.error('âŒ æ›´æ–°å‡€è¿å…¥äººå£å¤±è´¥:', e);
                document.getElementById('netMigration').textContent = '0';
            }
            
            try {
                document.getElementById('avgIncome').textContent = 
                    'Â¥' + incomeAvg.toLocaleString();
                console.log('âœ… å¹³å‡æ”¶å…¥æ›´æ–°æˆåŠŸ');
            } catch (e) {
                console.error('âŒ æ›´æ–°å¹³å‡æ”¶å…¥å¤±è´¥:', e);
                document.getElementById('avgIncome').textContent = 'Â¥0';
            }
            
            console.log('='.repeat(60) + '\n');
        }
        
        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderChart();
        }
        
        // æ¸²æŸ“å›¾è¡¨
        function renderChart() {
            console.log('\n' + '='.repeat(60));
            console.log('ğŸ“Š æ¸²æŸ“å›¾è¡¨ - æ ‡ç­¾:', currentTab);
            console.log('='.repeat(60));
            
            if (!allData) {
                console.error('âŒ allData ä¸ºç©ºï¼Œæ— æ³•æ¸²æŸ“å›¾è¡¨');
                return;
            }
            
            console.log('ğŸ“¦ å½“å‰æ•°æ®çŠ¶æ€:', {
                'total_population': allData.total_population,
                'city_population': allData.city_population ? 'å­˜åœ¨' : 'undefined',
                'gender': allData.gender ? 'å­˜åœ¨' : 'undefined',
                'age': allData.age ? 'å­˜åœ¨' : 'undefined',
                'education': allData.education ? 'å­˜åœ¨' : 'undefined',
                'migration': allData.migration ? 'å­˜åœ¨' : 'undefined',
                'ethnicity': allData.ethnicity ? 'å­˜åœ¨' : 'undefined'
            });
            
            let option = null;
            
            try {
                switch(currentTab) {
                    case 'city':
                        console.log('ğŸ™ï¸ æ¸²æŸ“åŸå¸‚åˆ†å¸ƒå›¾');
                        option = getCityOption();
                        break;
                    case 'gender':
                        console.log('ğŸ‘« æ¸²æŸ“æ€§åˆ«æ¯”ä¾‹å›¾');
                        option = getGenderOption();
                        break;
                    case 'age':
                        console.log('ğŸ‚ æ¸²æŸ“å¹´é¾„åˆ†å¸ƒå›¾');
                        option = getAgeOption();
                        break;
                    case 'education':
                        console.log('ğŸ“š æ¸²æŸ“å—æ•™è‚²ç¨‹åº¦å›¾');
                        option = getEducationOption();
                        break;
                    case 'migration':
                        console.log('ğŸš€ æ¸²æŸ“äººå£è¿ç§»å›¾');
                        option = getMigrationOption();
                        break;
                    case 'ethnicity':
                        console.log('ğŸŒˆ æ¸²æŸ“æ°‘æ—åˆ†å¸ƒå›¾');
                        option = getEthnicityOption();
                        break;
                    default:
                        console.warn('âš ï¸ æœªçŸ¥çš„æ ‡ç­¾:', currentTab);
                }
                
                if (option) {
                    console.log('âœ… å›¾è¡¨é…ç½®ç”ŸæˆæˆåŠŸ');
                    mainChart.setOption(option, true);
                    console.log('âœ… å›¾è¡¨æ¸²æŸ“å®Œæˆ');
                } else {
                    console.error('âŒ å›¾è¡¨é…ç½®ä¸ºç©º');
                }
            } catch (error) {
                console.error('âŒ æ¸²æŸ“å›¾è¡¨å¤±è´¥:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
            }
            
            console.log('='.repeat(60) + '\n');
        }
        
        // åŸå¸‚åˆ†å¸ƒå›¾
        function getCityOption() {
            const data = allData.city_population || {};
            const cities = Object.keys(data);
            const values = Object.values(data);
            
            console.log('ğŸ™ï¸ åŸå¸‚åˆ†å¸ƒæ•°æ®:', { cities, values });
            
            if (cities.length === 0) {
                console.warn('âš ï¸ åŸå¸‚æ•°æ®ä¸ºç©º');
            }
            
            return {
                title: {
                    text: 'å±±ä¸œçœå„åœ°å¸‚äººå£åˆ†å¸ƒ',
                    left: 'center',
                    textStyle: { fontSize: 24, color: '#00d4ff' }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: cities,
                    axisLabel: { rotate: 45, color: '#8a92a6' }
                },
                yAxis: {
                    type: 'value',
                    name: 'äººå£æ•°é‡',
                    axisLabel: { color: '#8a92a6' }
                },
                series: [{
                    name: 'äººå£æ•°é‡',
                    type: 'bar',
                    data: values,
                    itemStyle: { color: '#00d4ff' }
                }]
            };
        }
        
        // æ€§åˆ«æ¯”ä¾‹å›¾
        function getGenderOption() {
            const data = allData.gender || { male: 0, female: 0 };
            
            console.log('ğŸ‘« æ€§åˆ«æ•°æ®:', data);
            
            return {
                title: {
                    text: 'æ€§åˆ«æ¯”ä¾‹åˆ†æ',
                    left: 'center',
                    textStyle: { fontSize: 24, color: '#00d4ff' }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} äºº ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    top: 'center',
                    textStyle: { color: '#8a92a6' }
                },
                series: [{
                    name: 'æ€§åˆ«åˆ†å¸ƒ',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    data: [
                        { value: data.male, name: 'ç”·æ€§' },
                        { value: data.female, name: 'å¥³æ€§' }
                    ],
                    label: {
                        formatter: '{b}: {d}%',
                        color: '#e0e0e0'
                    },
                    color: ['#4db8ff', '#ff69b4']
                }]
            };
        }
        
        // å¹´é¾„åˆ†å¸ƒå›¾
        function getAgeOption() {
            const data = allData.age || { '0-18': 0, '18-35': 0, '35-60': 0, '60+': 0 };
            
            console.log('ğŸ‚ å¹´é¾„æ•°æ®:', data);
            
            return {
                title: {
                    text: 'å¹´é¾„åˆ†å¸ƒ',
                    left: 'center',
                    textStyle: { fontSize: 24, color: '#00d4ff' }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} äºº ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    top: 'center',
                    textStyle: { color: '#8a92a6' }
                },
                series: [{
                    name: 'å¹´é¾„æ®µ',
                    type: 'pie',
                    radius: '60%',
                    data: [
                        { value: data['0-18'], name: '0-18å²' },
                        { value: data['18-35'], name: '18-35å²' },
                        { value: data['35-60'], name: '35-60å²' },
                        { value: data['60+'], name: '60å²ä»¥ä¸Š' }
                    ],
                    label: { formatter: '{b}: {d}%', color: '#e0e0e0' },
                    color: ['#5470c6', '#91cc75', '#fac858', '#ee6666']
                }]
            };
        }
        
        // å—æ•™è‚²ç¨‹åº¦å›¾
        function getEducationOption() {
            const data = allData.education || {};
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            console.log('ğŸ“š æ•™è‚²æ•°æ®:', { labels, values });
            
            if (labels.length === 0) {
                console.warn('âš ï¸ æ•™è‚²æ•°æ®ä¸ºç©º');
            }
            
            return {
                title: {
                    text: 'å—æ•™è‚²ç¨‹åº¦åˆ†å¸ƒ',
                    left: 'center',
                    textStyle: { fontSize: 24, color: '#00d4ff' }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: labels,
                    axisLabel: { rotate: 45, color: '#8a92a6' }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: { color: '#8a92a6' }
                },
                series: [{
                    name: 'äººæ•°',
                    type: 'bar',
                    data: values,
                    itemStyle: { color: '#91cc75' }
                }]
            };
        }
        
        // äººå£è¿ç§»å›¾
        function getMigrationOption() {
            const data = allData.migration || { inflow: 0, outflow: 0, net: 0 };
            
            console.log('ğŸš€ è¿ç§»æ•°æ®:', data);
            
            return {
                title: {
                    text: 'äººå£è¿ç§»ç»Ÿè®¡',
                    left: 'center',
                    textStyle: { fontSize: 24, color: '#00d4ff' }
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    top: '10%',
                    textStyle: { color: '#8a92a6' }
                },
                series: [
                    {
                        name: 'è¿ç§»æƒ…å†µ',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        center: ['50%', '60%'],
                        data: [
                            { value: data.inflow, name: 'æµå…¥äººå£' },
                            { value: data.outflow, name: 'æµå‡ºäººå£' }
                        ],
                        label: {
                            formatter: '{b}: {c} äºº',
                            color: '#e0e0e0'
                        },
                        color: ['#00d4ff', '#ff6b6b']
                    }
                ]
            };
        }
        
        // æ°‘æ—åˆ†å¸ƒå›¾
        function getEthnicityOption() {
            const data = allData.ethnicity || {};
            const pieData = Object.entries(data).map(([name, value]) => ({
                name: name,
                value: value || 0
            }));
            
            console.log('ğŸŒˆ æ°‘æ—æ•°æ®:', { data, pieData });
            
            if (pieData.length === 0) {
                console.warn('âš ï¸ æ°‘æ—æ•°æ®ä¸ºç©º');
            }
            
            return {
                title: {
                    text: 'æ°‘æ—åˆ†å¸ƒï¼ˆå‰10åï¼‰',
                    left: 'center',
                    textStyle: { fontSize: 24, color: '#00d4ff' }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} äºº ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    top: 'center',
                    textStyle: { color: '#8a92a6' }
                },
                series: [{
                    name: 'æ°‘æ—',
                    type: 'pie',
                    radius: '60%',
                    data: pieData.slice(0, 10),
                    label: {
                        formatter: '{b}: {d}%',
                        color: '#e0e0e0'
                    }
                }]
            };
        }
        
        // æ˜¾ç¤º/éšè—åŠ è½½æç¤º
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }
    </script>
</body>
</html>

