# Source字段（数据来源代号）使用说明

## 📋 功能概述

系统现在要求用户在录入数据前，必须输入**数据来源代号**（source字段），用于标识数据录入者。

---

## 🎯 Source字段说明

### 是什么？

- **字段名称**：source（数据来源）
- **字段类型**：VARCHAR(64)
- **字段用途**：记录数据的录入者代号
- **是否必填**：✅ 是（新增要求）

### 为什么需要？

- 🔍 **追溯数据来源**：可以查询某个录入者录入了多少条数据
- 📊 **统计录入量**：按录入者统计工作量
- 🔒 **数据质量管理**：如果发现数据问题，可以追溯到录入者
- 👥 **多人协作**：区分不同录入者的数据

### 示例

```
录入者A的代号：YY
录入者B的代号：ZS
录入者C的代号：LS
```

---

## 🎨 Web界面使用

### Step 1: 输入代号

打开系统后，在**左侧边栏顶部**会看到：

```
👤 数据输入者信息
┌─────────────────────┐
│ 数据来源代号         │
│ [请输入您的代号...] │
└─────────────────────┘
⚠️ 请先输入数据来源代号
```

### Step 2: 输入您的代号

在输入框中输入您的代号，例如：`YY`

输入后会显示：
```
✅ 当前数据来源：YY
```

### Step 3: 开始录入

现在可以：
- 使用**身份证OCR识别**功能
- 使用**Excel批量导入**功能

所有录入的数据都会自动带上您的代号（YY）。

---

## 💻 命令行使用

### 方式1：命令行参数指定

```bash
python id_card_ocr.py id_card.jpg YY
```

参数说明：
- `id_card.jpg` - 身份证图片路径
- `YY` - 数据来源代号

### 方式2：交互式输入

```bash
python id_card_ocr.py id_card.jpg
```

系统会提示：
```
❓ 请输入数据来源代号（例如：YY）：
数据来源代号：
```

输入您的代号后按回车即可。

---

## ⚠️ 注意事项

### 1. 必须输入

如果不输入代号就尝试录入数据，会看到错误提示：

**Web界面**：
```
❌ 请先在侧边栏输入数据来源代号！
```

**命令行**：
```
❌ 数据来源代号不能为空
```

### 2. 代号规范

建议：
- ✅ 使用2-4个字符
- ✅ 使用大写字母或数字
- ✅ 有意义的缩写

示例：
- `YY` - 姓名首字母
- `ZS01` - 部门+工号
- `ADMIN` - 管理员

不建议：
- ❌ 过长的代号（如：`VERY_LONG_SOURCE_CODE_123456`）
- ❌ 特殊字符（如：`@#$%`）
- ❌ 空格（如：`A B C`）

### 3. 持久化保存

在Web界面中：
- 输入一次后，会自动保存在当前会话中
- 刷新页面后需要重新输入
- 更换代号只需在侧边栏重新输入即可

---

## 📊 数据查询

### 查询某个录入者的数据

```sql
-- 查询YY录入的所有数据
SELECT * FROM population WHERE source = 'YY';

-- 统计YY录入的数据量
SELECT COUNT(*) FROM population WHERE source = 'YY';
```

### 按录入者统计

```sql
-- 按录入者统计数据量
SELECT source, COUNT(*) as count
FROM population
GROUP BY source
ORDER BY count DESC;
```

### 查询录入时间

```sql
-- 查看YY在某个时间段录入的数据
SELECT * FROM population 
WHERE source = 'YY' 
  AND processed_at BETWEEN '2025-11-01' AND '2025-11-10';
```

---

## 🎯 使用场景

### 场景1：多人协作录入

团队成员：
- 张三（代号：ZS）
- 李四（代号：LS）
- 王五（代号：WW）

每个人使用自己的代号录入，管理员可以查看各自的工作量。

### 场景2：数据质量检查

发现某批数据有问题：
```sql
SELECT * FROM population WHERE source = 'YY';
```

可以快速定位是谁录入的，进行核对和修正。

### 场景3：工作量统计

月底统计各录入员的工作量：
```sql
SELECT 
    source as 录入者,
    COUNT(*) as 录入数量,
    DATE(processed_at) as 日期
FROM population
WHERE processed_at >= '2025-11-01'
GROUP BY source, DATE(processed_at);
```

---

## 🔧 Excel批量导入特别说明

### Excel模板中的source字段

Excel模板的最后一列是"数据来源"：
- **建议**：留空即可
- **原因**：系统会自动使用您在侧边栏输入的代号
- **如果填写**：Excel中的值会被系统覆盖

### 示例

Excel表格：

| 身份证号 | 姓名 | ... | 数据来源 |
|---------|------|-----|---------|
| 110... | 张三 | ... | （空）|
| 310... | 李四 | ... | （空）|

上传后，如果您的代号是`YY`，系统会自动将source设为`YY`。

---

## 📝 完整流程示例

### Web界面流程

```
1. 打开系统
   ↓
2. 在侧边栏输入代号：YY
   ↓
3. 看到提示：✅ 当前数据来源：YY
   ↓
4. 选择录入方式：
   ├─ OCR识别：上传身份证 → 识别 → 保存（source=YY）
   └─ Excel导入：上传表格 → 解析 → 导入（source=YY）
   ↓
5. 数据已保存，source字段均为YY
```

### 命令行流程

```bash
# 方式1：直接指定
$ python id_card_ocr.py id_card.jpg YY

🔍 正在识别身份证...
✅ 数据来源：YY
✅ 身份证识别成功
...

# 方式2：交互输入
$ python id_card_ocr.py id_card.jpg

🔍 正在识别身份证...

❓ 请输入数据来源代号（例如：YY）：
数据来源代号：YY

✅ 数据来源：YY
✅ 身份证识别成功
...
```

---

## 🎨 界面截图说明

### Web界面左侧边栏

```
┌─────────────────────────────┐
│ 👤 数据输入者信息            │
│                              │
│ 数据来源代号                 │
│ ┌─────────────────────────┐ │
│ │ YY                      │ │
│ └─────────────────────────┘ │
│                              │
│ ✅ 当前数据来源：YY          │
│                              │
├─────────────────────────────┤
│ 📝 使用说明                  │
│ ...                          │
└─────────────────────────────┘
```

---

## 🆕 更新内容

### 版本 2.1

**新增功能**：
- ✅ 侧边栏添加"数据来源代号"输入框
- ✅ 强制要求输入代号后才能录入数据
- ✅ OCR识别和Excel导入都使用统一的代号
- ✅ 命令行版本支持代号参数

**修改内容**：
- `id_card_app.py`：新增侧边栏输入框和验证逻辑
- `id_card_ocr.py`：新增source参数支持

**数据库**：
- source字段：保存用户输入的代号
- 不再使用固定值（'image'或'excel'）

---

## 📞 常见问题

### Q1: 忘记输入代号怎么办？

**A**: 系统会阻止您录入并提示错误。请在侧边栏输入代号后再试。

### Q2: 可以更改代号吗？

**A**: 可以。在侧边栏重新输入新代号即可，后续录入的数据会使用新代号。

### Q3: 已经录入的数据能改代号吗？

**A**: 需要在数据库中手动修改：
```sql
UPDATE population SET source = '新代号' WHERE source = '旧代号';
```

### Q4: 代号区分大小写吗？

**A**: 是的。`YY`和`yy`是不同的代号。

### Q5: Excel表格中填写的source会生效吗？

**A**: 不会。系统会自动使用您在侧边栏输入的代号覆盖Excel中的值。

---

## 📈 最佳实践

### 1. 代号管理

建议维护一个代号表：

| 姓名 | 代号 | 部门 | 备注 |
|-----|------|------|------|
| 张三 | ZS | 行政部 | 录入员 |
| 李四 | LS | 技术部 | 录入员 |
| 王五 | WW | 行政部 | 管理员 |

### 2. 统一规范

团队统一代号格式，例如：
- 姓名拼音首字母大写：`ZS`, `LS`, `WW`
- 工号：`001`, `002`, `003`
- 部门+姓名：`XZ_ZS`, `JS_LS`

### 3. 定期审计

定期检查数据录入情况：
```sql
-- 最近一周的录入统计
SELECT 
    source,
    COUNT(*) as 录入量,
    MIN(processed_at) as 最早录入,
    MAX(processed_at) as 最近录入
FROM population
WHERE processed_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY source;
```

---

## ✅ 总结

- 📌 **必填项**：录入数据前必须输入代号
- 📌 **Web界面**：在左侧边栏输入
- 📌 **命令行**：通过参数或交互输入
- 📌 **用途**：追溯数据来源，统计工作量
- 📌 **建议**：使用简短有意义的代号

---

**版本**：2.1.0  
**更新日期**：2025-11-09  
**功能状态**：✅ 已完成

